<map:sitemap xmlns:map="http://www.nexista.org/sitemap"> 
    <map:prepend>
        <map:script src="lib/php/runtime.php"/>
        <map:xml src="i18n/en_US/yodnsconf.xml"/>
    </map:prepend>

    <map:gate name="index" role="yodnsuser" cache="600" client_cache="300">
        <map:action type="like" params="//_get/origin"/>
        <map:query src="data/sql/zones_get_all.xml"/>
        <map:xsl src="templates/xsl/zones.xsl"/>
    </map:gate>

    <map:gate name="zone-edit" role="yodnsuser">
        <map:switch name="//_post/action">
            <map:case value="edit">
                <map:plugin type="serial" params="{//_post/serial}"/>
                <map:query src="data/sql/zone_update.xml"/>
                <map:action type="redirect" params="{//link_prefix}zone-edit&amp;zone={//_post/zone}"/>
            </map:case>
            <map:case value="create">
                <map:plugin type="serial" params="{//_post/serial}"/>
                <map:query src="data/sql/zone_create.xml"/>
                <map:action type="redirect" params="{//link_prefix}zones"/>
            </map:case>
            <map:default>
            </map:default>
        </map:switch>
        <map:query src="data/sql/zone_get_by_id.xml"/>
        <map:xsl src="templates/xsl/zone_edit.xsl"/>
    </map:gate>

    <map:gate name="x-zone-delete" role="yodnsuser">
        <map:query src="data/sql/zone_delete.xml"/>
    </map:gate>

    <map:gate name="records" role="yodnsuser">
        <map:xml src="config/default_dns_records.xml"/>
        <map:action type="like" params="//_get/name"/>
        <map:xml src="data/xml/dns_record_types.xml"/>
        <map:query src="data/sql/zone_get_by_id.xml"/>
        <map:query src="data/sql/records_get_by_zone_id.xml"/>
        <map:xsl src="templates/xsl/records.xsl"/>
    </map:gate>

    <map:gate name="record-edit" role="yodnsuser">
        <map:switch name="//_post/action">
            <map:case value="edit">
                <map:plugin type="serial" params="{//_post/serial}"/>
                <map:query src="data/sql/record_update.xml"/>
                <map:query src="data/sql/zone_serial_update.xml"/>
                <map:action type="redirect" params="{//link_prefix}record-edit&amp;id={//_post/id}&amp;zone={//_post/zone}"/>
            </map:case>
            <map:case value="create">
                <map:plugin type="serial" params="{//_post/serial}"/>
                <map:query src="data/sql/record_create.xml"/>
                <map:query src="data/sql/zone_serial_update.xml"/>
                <map:action type="redirect" params="{//link_prefix}records&amp;zone={//_post/zone}"/>
            </map:case>
            <map:default>
            </map:default>
        </map:switch>
        <map:xml src="data/xml/dns_record_types.xml"/>
        <map:query src="data/sql/zone_get_by_id.xml"/>
        <map:query src="data/sql/record_get_by_id.xml"/>
        <map:xsl src="templates/xsl/record_edit.xsl"/>
    </map:gate>
    <map:gate name="x-record-delete" role="yodnsuser">
        <map:query src="data/sql/record_delete.xml"/>
        <map:query src="data/sql/zone_get_by_id.xml"/>
        <map:plugin type="serial" params="{//zone_get_by_id/serial}"/>
        <map:query src="data/sql/zone_serial_update.xml"/>
    </map:gate>
    
    <map:gate name="zone-create-default-dns-records" role="yodnsuser">
        <map:if name="//_post">
            <map:true>
                <map:xml src="config/default_dns_records.xml"/>
                <map:query src="data/sql/zone_create_default_dns_records.xml"/>
                <map:plugin type="serial" params="{//_post/serial}"/>
                <map:query src="data/sql/zone_serial_update.xml"/>
            </map:true>
            <map:false>
            </map:false>
        </map:if>
    </map:gate>


    <map:gate name="tools-query" role="yodnsuser">
        <map:plugin type="net_dns" params="{//_get/hostname},{//defaults/dig_target},{//_get/type}"/>
        <map:xsl src="templates/xsl/tools_query.xsl"/>
    </map:gate>

</map:sitemap>