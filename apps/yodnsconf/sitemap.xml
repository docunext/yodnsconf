<!--
Program: YoDNSConf
Component: sitemap.xml
Copyright: Savonix Corporation
Author: Albert L. Lash, IV
License: Gnu Affero Public License version 3
http://www.gnu.org/licenses

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program; if not, see http://www.gnu.org/licenses
or write to the Free Software Foundation,Inc., 51 Franklin Street,
Fifth Floor, Boston, MA 02110-1301  USA
-->
<map:sitemap xmlns:map="http://www.nexista.org/sitemap">
    <map:prepend>
        <map:script src="lib/php/runtime.php"/>
        <map:xml src="data/xml/main_menu.xml"/>
        <map:xml src="i18n/en_US/yodnsconf.xml"/>
        <map:set name="theme" value="default"/>
    </map:prepend>

    <map:gate name="index" role="yodnsuser" cache="600" client_cache="300">
      <map:if name="//_get/origin">
        <map:true>
          <map:action type="concat" params="%,{//_get/origin},//_get/origin"/>
          <map:action type="concat" params="{//_get/origin},%,//_get/origin"/>
        </map:true>
        <map:false>
        </map:false>
      </map:if>
        <map:query src="data/sql/zones_get_all.xml"/>
        <map:xsl src="templates/xsl/zones.xsl"/>
    </map:gate>

    <map:gate name="zone-edit" role="yodnsuser">
        <map:switch name="//_post/action">
            <map:case value="edit">
                <map:plugin type="serial" params="{//_post/serial}"/>
                <map:query src="data/sql/zone_update.xml"/>
                <map:action type="redirect" params="{//link_prefix}zone-edit&amp;zone={//_post/zone}"/>
            </map:case>
            <map:case value="create">
                <map:plugin type="serial" params="{//_post/serial}"/>
                <map:query src="data/sql/zone_create.xml"/>
                <map:action type="redirect" params="{//link_prefix}zones"/>
            </map:case>
            <map:default>
            </map:default>
        </map:switch>
        <map:query src="data/sql/zone_get_by_id.xml"/>
        <map:query src="data/sql/records_get_by_zone_id.xml"/>
        <map:xsl src="templates/xsl/zone_edit.xsl"/>
    </map:gate>

    <map:gate name="x-zone-delete" role="yodnsuser">
        <map:query src="data/sql/zone_delete.xml"/>
    </map:gate>

    <map:gate name="redirects" role="yodnsuser" cache="600" client_cache="300">
        <map:query src="data/sql/redirects_get_all.xml"/>
        <map:xsl src="templates/xsl/redirects.xsl"/>
    </map:gate>
    <map:gate name="redirect-edit" role="yodnsuser" cache="600" client_cache="300">
        <map:query src="data/sql/redirects_get_all.xml"/>
        <map:xsl src="templates/xsl/redirect_edit.xsl"/>
    </map:gate>
    <map:gate name="x--redirects-export" role="yodnsuser">
        <map:action type="header" params="Content-Type,text/plain"/>
        <map:query src="data/sql/redirects_get_all.xml"/>
        <map:action type="pad" params="//redirects_get_all/redirects_get_all/http_host,30, "/>
        <map:xsl src="templates/xsl/redirects_export.xsl"/>
    </map:gate>
    <map:gate name="x--redirect-delete" role="yodnsuser">
        <map:action type="header" params="Content-Type,text/xml"/>
        <map:query src="data/sql/redirect_delete.xml"/>
    </map:gate>

    <map:gate name="records" role="yodnsuser">
        <map:xml src="config/default_dns_records.xml"/>
        <map:if name="//_get/origin">
          <map:true>
            <map:action type="concat" params="%,{//_get/name},//_get/name"/>
            <map:action type="concat" params="{//_get/name},%,//_get/name"/>
            </map:true>
          <map:false>
          </map:false>
        </map:if>
        <map:xml src="data/xml/dns_record_types.xml"/>
        <map:query src="data/sql/zone_get_by_id.xml"/>
        <map:query src="data/sql/records_get_by_zone_id.xml"/>
        <map:xsl src="templates/xsl/records.xsl"/>
    </map:gate>

    <map:gate name="record-edit" role="yodnsuser">
        <map:switch name="//_post/action">
            <map:case value="edit">
                <map:plugin type="serial" params="{//_post/serial}"/>
                <map:query src="data/sql/record_update.xml"/>
                <map:query src="data/sql/zone_serial_update.xml"/>
                <map:action type="redirect" params="{//link_prefix}records&amp;zone={//_post/zone}"/>
            </map:case>
            <map:case value="create">
                <map:plugin type="serial" params="{//_post/serial}"/>
                <map:query src="data/sql/record_create.xml"/>
                <map:query src="data/sql/zone_serial_update.xml"/>
                <map:action type="redirect" params="{//link_prefix}records&amp;zone={//_post/zone}"/>
            </map:case>
            <map:default>
            </map:default>
        </map:switch>
        <map:xml src="data/xml/dns_record_types.xml"/>
        <map:query src="data/sql/zone_get_by_id.xml"/>
        <map:query src="data/sql/record_get_by_id.xml"/>
        <map:xsl src="templates/xsl/record_edit.xsl"/>
    </map:gate>
    <map:gate name="x-record-delete" role="yodnsuser">
        <map:query src="data/sql/record_delete.xml"/>
        <map:query src="data/sql/zone_get_by_id.xml"/>
        <map:plugin type="serial" params="{//zone_get_by_id/serial}"/>
        <map:query src="data/sql/zone_serial_update.xml"/>
    </map:gate>

    <map:gate name="zone-create-default-dns-records" role="yodnsuser">
        <map:if name="//_post">
            <map:true>
                <map:xml src="config/default_zone_records.xml"/>
                <map:query src="data/sql/zone_create_default_dns_records.xml"/>
                <map:plugin type="serial" params="{//_post/serial}"/>
                <map:query src="data/sql/zone_serial_update.xml"/>
            </map:true>
            <map:false>
            </map:false>
        </map:if>
    </map:gate>

    <map:gate name="zone-create-default-a-records" role="yodnsuser">
        <map:if name="//_post">
            <map:true>
                <map:xml src="config/default_zone_records.xml"/>
                <map:query src="data/sql/zone_create_default_a_records.xml"/>
                <map:plugin type="serial" params="{//_post/serial}"/>
                <map:query src="data/sql/zone_serial_update.xml"/>
            </map:true>
            <map:false>
            </map:false>
        </map:if>
    </map:gate>


    <map:gate name="tools-query" role="yodnsuser">
        <map:plugin type="net_dns" params="{//_get/hostname},{//defaults/dig_target},{//_get/type}"/>
        <map:xsl src="templates/xsl/tools_query.xsl"/>
    </map:gate>



    <map:gate name="iframe-viewer" cache="0">
        <map:xsl src="templates/xsl/iframe_viewer.xsl"/>
    </map:gate>

    <map:gate name="themed-css" cache="0">
        <map:action type="header" params="Content-Type,text/css"/>
        <map:raw src="templates/themes/{//theme}/css/style.css" />
    </map:gate>
    <map:gate name="dynamic-css" cache="0">
        <map:action type="header" params="Content-Type,text/css"/>
        <map:xsl src="templates/css/dynamic.css.xsl"/>
    </map:gate>
    <map:gate name="license" cache="0">
        <map:action type="header" params="Content-Type,text/plain"/>
        <map:raw src="LICENSE" />
    </map:gate>

</map:sitemap>